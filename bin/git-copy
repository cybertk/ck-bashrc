#!/bin/sh
#
# Copy a remote git repo to another remote destination
# https://gist.github.com/cybertk/8a61ed9aca71a66cd711
#
# Copyright (C) 2015 Quanlong <kyan.ql.he@gmail.com>

set -e

# Options validation
if [ -z "$1" -o -z "$2" ];
then
    echo "Usage: git copy <source_repo_url> <destionation_repo_url>"
    exit 1
fi

SRC_REPO=$1
DST_REPO=$2

# Clone source into temp working dir
repo_name=`mktemp -d -t ck-git-copy`
git clone --bare ${SRC_REPO} ${repo_name}
pushd ${repo_name} > /dev/null

# Push to destination
echo "Pushing to ${DST_REPO}"
git push --mirror ${DST_REPO}

# Recovery
popd > /dev/null
rm -rf ${repo_name}
